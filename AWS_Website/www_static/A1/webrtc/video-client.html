<html>
<head>
<script src="//cdn.webrtc-experiment.com/RTCMultiConnection.js"></script>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="/socket.io/socket.io.js"></script>
<style>
video {
	display: block;
    width: 90%;
}
</style>
<script>
// DUPLICATE SOCKET
var socketWebrtc = io.connect(document.location.hostname + ':' + location.port);
var participants = new RTCMultiConnection('slite-video');

socketWebrtc.on('sharing-client', function (data) {
	startSession(data.moderatorId, data.chatMode);
	function startSession(moderatorId, chatMode) {
		var MODERATOR_CHANNEL_ID = 'slite-video'; // channel-id
		var MODERATOR_SESSION_ID = '<%= hash %>-video';    // room-id
		var MODERATOR_ID         = '' + moderatorId + '';    // user-id
		var MODERATOR_SESSION = {};
		
		if(chatMode == 1) {
			MODERATOR_SESSION    = {         
			};
		}
		else if(chatMode == 2) {
			MODERATOR_SESSION    = {        
				video: true,
				audio: true
			};			
		}
		
		participants.join(	{	
				sessionid: MODERATOR_SESSION_ID,
				userid:    MODERATOR_ID,
				session:   MODERATOR_SESSION
			}
		);

		/*participants.onNewSession = function(session) {
			alert(session);
		}*/
		
		participants.onstream = function(event) {
			if(event.isVideo) {
				if(event.type == "local") {
					$( "#videosharing" ).append(event.mediaElement);
				}
				else {
					$( "#videosharingR" ).append(event.mediaElement);		
				}
			}
			if (event.isAudio) {
				$( "#audiosharing" ).append(event.mediaElement);
			}
		};
	}

});

function start() {
	socketWebrtc.emit("sharing-server", {hash: '<%= hash %>'});
}

</script>
</head>
<body onload="start()">
<div id="videosharing" style="position: fixed; width: 100px; top: 10px; right: 40px; border: 1px solid #3F7FBF;"></div>
<div id="videosharingR"></div>
<div id="audiosharing"></div>
</body>
</html>