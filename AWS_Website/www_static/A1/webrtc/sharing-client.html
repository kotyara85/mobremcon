<html>
<head>
<script src="/A1/js/webrtc/RTCMultiConnection.min.js"></script>
<script src="//cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
<script src="/A1/js/webrtc/FirebaseConnection.js"></script>
<script src="/socket.io/socket.io.js"></script>
<style>
audio {
	display: none;
}
video {
	display: block;
    width: 90%;
}
</style>
<script>
// DUPLICATE SOCKET
var hashScreen = '<%= hash %>-screen';
var sharingClientSocket;
var participants;

if(typeof parent.socket != "undefined") {
	sharingClientSocket = parent.socket
}
else {
	sharingClientSocket = io.connect(document.location.hostname + ':' + location.port);
}

function start() {
	participants = new RTCMultiConnection('prezera-screen');

	participants.bandwidth = {
		audio: 128,
		video: 256,
		data: 1638400,
		screen: 300
	};

	participants.setCustomSocketHandler(FirebaseConnection);
	participants.session = {
			screen: true,
			audio: true,
			oneway: true
	};

	participants.join(hashScreen);

	participants.onstreamended = function(event) {
		if(event.type == "remote" && event.userid == hashScreen) {
			console.log("Lost video connection with presenter. Reconnecting...");
			location.reload();
		}
	};
}

function stopSession() {
	participants.leave();
}

</script>
</head>
<body onload="start()">
	<div id="screensharing"></div>
	<div id="audiosharing"></div>
</body>
</html>
