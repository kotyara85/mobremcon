<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    
    <head>
        <meta content="yes" name="apple-mobile-web-app-capable" />
        <meta content="index,follow" name="robots" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
        <link href="iWebKit/pics/homescreen.gif" rel="apple-touch-icon" />
        <meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
		
		<link href="css/index.css" rel="stylesheet" media="screen" type="text/css" />
        <link href="iWebKit/css/style.css" rel="stylesheet" media="screen" type="text/css" />
        <script src="iWebKit/javascript/functions.js" type="text/javascript"></script>
        <title>Healthy Weather</title>
		
		<style type="text/css">
		
		</style>
        
        
        
        <script type="text/javascript" charset="utf-8" src="js/controls.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/cordova-1.7.0.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/NativeControls.js"></script>
        
        <link rel="stylesheet" type="text/css" href="jqplot/jquery.jqplot.cs" />
        <link rel="stylesheet" type="text/css" href="jqplot/jquery.jqplot.min.cs" />
        <script type="text/javascript" src="jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
        <script type="text/javascript" src="jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
		<script type="text/javascript" src="jqplot/plugins/jqplot.enhancedLegendRenderer.js"></script>
        <script class="include" type="text/javascript" src="jqplot/jquery.min.js"></script>
		
		<script type="text/javascript">
		
				function showHome(){
					$(".webpage").css("display","none");
					$("#content").css("display","block");
					$("#todaylink").removeClass("pressed");
				}
			
				function showToday(){
					//$(".webpage").css("display","none");
					$("#today").css("display","block");
					$("#homelink").removeClass("pressed");
					
					
					$("#temperatureSummary").html(localStorage.temperatureSummary);				
					$("#temperatureTodayMax").html("Today max temperature is: "+localStorage.temperatureTodayMax);
					$("#solarSummary").html(localStorage.solarSummary+" (today's solar value: "+localStorage.solarToday+")");
					
					var pressureTodayAdditionalText = "normal";
					if(localStorage.pressureToday > 1014.25){
						pressureTodayAdditionalText = "above normal";
					}
					if(localStorage.pressureToday < 1012.25){
						pressureTodayAdditionalText = "bellow normal";
					}					
					$("#pressureToday").html("Atmospheric pressure: "+localStorage.pressureToday+" - "+pressureTodayAdditionalText);
					
					
					localStorage.isCameFromPage = true;					
				}
		</script>
        
        
    </head>
    
    <body>
        
        <div id="topbar" style="padding-bottom:1px;margin-bottom:1px">
            <div id="title">Health Climate</div>
			<div id="leftbutton">
                <a href="javascript:showHome()" class="noeffect">Home</a> </div>
			</div>
            <div id="rightbutton">
                <a href="about.html" class="noeffect">About</a> </div>
			</div>
		</div>
		
		
		<div id="solar" class="webpage" style="display:none;padding:5px">
			<center>
				<div id="solarDetails" style="padding:10px;text-align:left"></div>
			</center>
		</div>

		<div id="pressure" class="webpage" style="display:none;padding:5px">
			<center>
				<table id="pressureTable" class="datatable">
					<caption>Hourly Pressure</caption>
					<tr>
						<th>Time</th>
						<th>Pressure</th>
					</tr>
				
				</table>
			</center>
		</div>
		
		<div id="temperature" class="webpage" style="display:none;padding:5px">
			<center>
				<table id="temperatureTable" class="datatable">
					<caption>Hourly Temperature</caption>
					<tr>
						<th>Time</th>
						<th>Temperature</th>
					</tr>
				
				</table>
			</center>
		</div>
		
<table>
	<tr>
		<td>
        <div id="contentt" class="webpage">
		
			<center>
				<div id='tempMessage' style='padding-top:40px;padding-bottom:40px'>
					<div>LOADING DATA FROM YOUR WEATHER STATION ... </div>
					<img src='img/loader.gif'/>
				</div>
			</center>
			
			
            <ul id="graphs" class="pageitem" style='display:none'> 
                <li>
                    <div id="chart1" style="height:200px; width:500px;" onclick="showDetails('pressure')"></div>
                </li>
                <li>
                    <div id="chart2" style="height:200px; width:500px;" onclick="showSolar()"></div>
                </li>              
                <li>
                    <div id="chart3" style="height:200px; width:500px;" onclick="showDetails('temperature')"></div>
                </li>
            </ul>
			
			<div id="graph_legend" style="display:none;padding-right:5px;float:right">
				<span style='font-size:13px;'><b>Normal</b> is shown as red line:&nbsp;</span><img src="img/redline.png"/>
			</div>      
			
		</div>
		</td>
		
		<td>
		<div id="today" class="webpage" style="padding:5px;font-size:18px;">
			<center><h3>Weather Today</h3></center>
				<p class="textWeather" id="temperatureSummary"></p>
				<p class="textWeather" id="solarSummary"></p>
				<p class="textWeather" id="solarToday"></p>
				<p class="textWeather" id="pressureToday"></p>
				<p class="textWeather" id="temperatureTodayMax"></p>
		</div>
		</td>
	</tr>
</table>
        
            <script type="text/javascript" src="cordova.js"></script>
            <script type="text/javascript" src="js/index.js"></script>
            
            <script class="include" type="text/javascript" src="jqplot/jquery.jqplot.min.js"></script>
            <script type="text/javascript" src="jqplot/examples/syntaxhighlighter/scripts/shCore.min.js"></script>
            <script type="text/javascript" src="jqplot/examples/syntaxhighlighter/scripts/shBrushJScript.min.js"></script>
            <script type="text/javascript" src="jqplot/examples/syntaxhighlighter/scripts/shBrushXml.min.js"></script>
            <script class="include" type="text/javascript" src="jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
            <script class="include" type="text/javascript" src="jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
            <script type="text/javascript" src="jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
            <script type="text/javascript" src="jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
            <script type="text/javascript" src="jqplot/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
            <script type="text/javascript" src="jqplot/plugins/jqplot.categoryAxisRenderer.min.js"></script>
            <script type="text/javascript" src="jqplot/plugins/jqplot.barRenderer.min.js"></script>
			<script type="text/javascript" src="jqplot/plugins/jqplot.enhancedLegendRenderer.js"></script>
            
            
            <script type="text/javascript">
				
				var weatherData = null;
				
								
				function showSolar(){
					$(".webpage").css("display","none");
					$("#solar").css("display","block");
					$("#solarDetails").html(localStorage.solarSummary+" (today's solar value: "+localStorage.solarToday+")");
					
				}
				
				
				function showPressure(){
					$(".webpage").css("display","none");
					$("#pressure").css("display","block");
					var rowsHtml = "";
					var time;
					for(var i=0;i<weatherData.hourly.length;i++){
						time = new Date(weatherData.hourly[i]['time']*1000);
						rowsHtml += "<tr><td>"+time.getHours()+":00</td><td>"+weatherData.hourly[i]['pressure']+"</td></td>";
					}
					$('#pressureTable tr:last').after(rowsHtml);
					
				}
				
				function showDetails(name){
					$(".webpage").css("display","none");
					var fullName = "#"+name;
					$(fullName).css("display","block");
					var rowsHtml = "";
					var time;
					for(var i=0;i<weatherData.hourly.length;i++){
						time = new Date(weatherData.hourly[i]['time']*1000);
						rowsHtml += "<tr><td>"+time.getHours()+":00</td><td>"+weatherData.hourly[i][name]+"</td></td>";
					}
					var tableName = "#"+name+"Table";
					$(tableName + ' tr:last').after(rowsHtml);
					
				}
			
                function onPositionSuccess(position){
					  
					  $.get("http://healthclimate.nodejitsu.com/?lat="+position.coords.latitude+"&long="+position.coords.longitude+"", function(dataLocal) {
					  
							$("#tempMessage").css("display","none");
							$("#graphs").css("display","block");	
							$("#graph_legend").css("display","block");
					  
							
							weatherData = $.parseJSON(dataLocal);
							
					  var line1 = [['before', weatherData.pressure[0]], ['yesterday', weatherData.pressure[1]], ['TODAY', weatherData.pressure[2]],['tommorrow', weatherData.pressure[3]], ['after', weatherData.pressure[4]]];
					  var line2 = [['before', 1013.25],['after', 1013.25]];
					  
					  var line3 = [['before', weatherData.solar[0]], ['yesterday', weatherData.solar[1]], ['TODAY', weatherData.solar[2]],['tommorrow', weatherData.solar[3]], ['after', weatherData.solar[4]]];
					  var line4 = [['before', 5],['after', 5]];
					  var line5 = [['before', weatherData.temperature[0]], ['yesterday', weatherData.temperature[1]], ['TODAY', weatherData.temperature[2]],['tommorrow', weatherData.temperature[3]], ['after', weatherData.temperature[4]]];
					  
					  
					  localStorage.temperatureSummary = weatherData.temperatureSummary;
					  localStorage.temperatureTodayMax = weatherData.temperature[2];
					  localStorage.pressureToday = weatherData.pressure[2];
					  localStorage.solarSummary = weatherData.solarSummary;
					  localStorage.solarToday = weatherData.solar[2];
					  
					  
					  
					  var plot1 = $.jqplot('chart1', [line1,line2], {
						   title: 'Атмосферное Давление',
						   axesDefaults: {
						   tickRenderer: $.jqplot.CanvasAxisTickRenderer ,
						   tickOptions: {
						   angle: -30,
						   fontSize: '8pt'
						   }
						   },
						   axes: {
							   xaxis: {
								   renderer: $.jqplot.CategoryAxisRenderer
							   }
						   },						   
						   seriesColors: [ "#0000FF", "#FF0000"],
						   series: [{},{linePattern: 'dashed', lineWidth: 1}]
						   });
										   
					var plot2 = $.jqplot('chart2', [line3,line4], {
						   title: 'Магнитные Бури',
						   axesDefaults: {
						   tickRenderer: $.jqplot.CanvasAxisTickRenderer ,
						   tickOptions: {
						   angle: -30,
						   fontSize: '8pt'
						   }
						   },
						   axes: {
							   xaxis: {
								   renderer: $.jqplot.CategoryAxisRenderer
							   },
							   yaxis:{
								   min:0,
								   max:8,
								   ticks: ['2','4','6','8']
							   }
						   },
						   seriesColors: [ "#0000FF", "#FF0000"],
						   series: [{},{linePattern: 'dashed', lineWidth: 1}]
								
						   });
				var plot3 = $.jqplot('chart3', [line5], {
						   title: 'Температура (максимум)',
						   axesDefaults: {
						   tickRenderer: $.jqplot.CanvasAxisTickRenderer ,
						   tickOptions: {
						   angle: -30,
						   fontSize: '8pt'
						   }
						   },
						   axes: {
							   xaxis: {
								   renderer: $.jqplot.CategoryAxisRenderer
							   }
						   },						   
						   seriesColors: [ "#0000FF"]
						   });				  
					  
                      });
					    
					  
				showToday();
					  
				}
				
				function onPositionFailure(){
				
				
					
					$.get("http://maps.googleapis.com/maps/api/geocode/json?address=Mountain+View,+CA&sensor=false", function(dataGoogle) {
							var lat = dataGoogle['results'][0]['geometry']['location']['lat'];
							var lng = dataGoogle['results'][0]['geometry']['location']['lng'];
							var positionGoogle = {};
							positionGoogle.coords = {};
							positionGoogle.coords.latitude = lat;
							positionGoogle.coords.longitude = lng;
							onPositionSuccess(positionGoogle);
						}
					);
					
					
				}
				
				function getGeoLocation(){
						navigator.geolocation.getCurrentPosition(onPositionSuccess);
				}
				
				function onResume(){
					location.reload();
				}
				
				function onDeviceReady(){
					getGeoLocation();
				}
								
				onPositionFailure();
				
                </script>
            
    </body>
    
</html>
