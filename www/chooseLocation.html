<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<!-- Dependencies: JQuery and GMaps API should be loaded first -->
	<script class="include" type="text/javascript" src="jqplot/jquery.min.js"></script>
	<!--<script src="js/googleMaps.js"></script>-->
	<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

	<!-- CSS and JS for our code -->
	<link rel="stylesheet" type="text/css" href="css/jquery-gmaps-latlon-picker.css"/>
	<script src="js/jquery-gmaps-latlon-picker.js"></script>
	
	<link href="iWebKit/css/style.css" rel="stylesheet" media="screen" type="text/css" />
	<script src="iWebKit/javascript/functions.js" type="text/javascript"></script>
	
	<script>
	
	function setLocation(){
		localStorage.long = $("#long").val();
		localStorage.lat = $("#lat").val();
		localStorage.locationName = $("#locationName").val();
		window.location = "index.html";
	}
	
	function resetLocation(){
		localStorage.lat = null;
		localStorage.long = null;
		localStorage.locationName = null;
		window.location = "index.html";
	}
	
	</script>
</head>


<body onload="onDeviceReady()">
	<div id="topbar" style="padding-bottom:1px;margin-bottom:1px">
		<div id="title">Health Climate</div>
		<div id="leftbutton">
			<a href="index.html" class="noeffect">Home</a> </div>
		</div>
	</div>
	
	
<div id="currentLocation"></div>

<form id="locationForm">

	<fieldset class="gllpLatlonPicker" id="custom_id" >
		<input type="text" id="locationInput" class="gllpSearchField">
		<input type="button" class="gllpSearchButton" value="search">
		<a class="noeffect" href="javascript:setLocation()"><input type="button" value="set"></a>
		<a class="noeffect" href="javascript:resetLocation()"><input type="button" value="reset"></a>
		<br/><br/>
		<div class="gllpMap" id="map" vstyle="margin-left:10px;">Google Maps</div>
		<input type="hidden" class="gllpLatitude" id="lat" value="37.33174"/>
		<input type="hidden" class="gllpLongitude" id="long" value="-122.03033"/>
		<input type="hidden" class="gllpZoom" value="12"/>
		<input type="text" class="gllpLocationName" id="locationName" style="display:none" size=42/>
		<input type="button" class="gllpUpdateButton" style="display:none" id="gllpUpdateButton" value="update map">
	</fieldset>
<div id="locationVisibleName"></div>

</form>
	
<center>
	<ul class="pageitem" style="text-align:left; font-size:12px">
		<li>Type your adress <b>or</b> select location on the map by double clicking</li>
		
		<li>Press <b>set</b> to use loction you set in 1) <b>or</b> press <b>reset</b> to reset to current location.</li>
	</ul>
</center>

<script type="text/javascript">
	
	function onPositionSuccess(){
		var t=setTimeout(function(){
			if(localStorage.lat && localStorage.lat != "null"){
				$("#lat").val(localStorage.lat);
				$("#long").val(localStorage.long);
			}else if(localStorage.latLocal){
				$("#lat").val(localStorage.latLocal);
				$("#long").val(localStorage.longLocal);
			}
			$("#gllpUpdateButton").click();
			
			/*alert("2 latitude: "+position.coords.latitude+"\n"+
			  "longitude: "+position.coords.longitude+"\n"+
			  "timestamp: "+position.coords.timestamp+"\n");
			  */
		  },500);
	}
	
	function onDeviceReady(){
		//navigator.geolocation.getCurrentPosition(onPositionSuccess);
		if(localStorage.locationName && localStorage.locationName != "null"){
			$("#locationName").val(localStorage.locationName);
			$("#locationVisibleName").val(localStorage.locationName);
		}else{
			$("#locationName").val("Displaying your current location");
		}
		onPositionSuccess();
	}
	
	

	$(document).ready(onDeviceReady);
	
	 
	/*$(function{
		document.addEventListener("deviceready", onDeviceReady, false);
		alert('after add');
	}*/
	
	
	
	/*$(function(){
		alert("in func");
		document.addEventListener("deviceready",onDeviceReady,false);
	});*/
		
</script>
	
</body>
</html>
